name: Update JS Files

on:
  workflow_dispatch:
  # Uncomment the following if you still want a scheduled trigger
  # schedule:
  #   - cron: "0 */2 * * *"

permissions:
  actions: write
  contents: write

jobs:
  download-js:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        repository: sooyaaabo/VOD-CMS
        path: VOD-CMS

    - name: Download JS files
      run: |
        mkdir -p VOD-CMS/XPTV/JS
        declare -A jsfiles=(
          [91Jav]="https://raw.githubusercontent.com/Yswag/xptv-extensions/main/js/91jav.js"
          [AVDB]="https://raw.githubusercontent.com/Yswag/xptv-extensions/main/js/avdb.js"
          [AVToday]="https://raw.githubusercontent.com/Yswag/xptv-extensions/main/js/avtoday.js"
          [Hanime1]="https://raw.githubusercontent.com/Yswag/xptv-extensions/main/js/hanime.js"
          [HoHoJ]="https://raw.githubusercontent.com/Yswag/xptv-extensions/main/js/hohoj.js"
          [Jable]="https://raw.githubusercontent.com/Yswag/xptv-extensions/main/js/jable.js"
          [KoreaPornMovie]="https://raw.githubusercontent.com/fangkuia/XPTV/main/js/KoreaPornMovie.js"
          [MissAV]="https://raw.githubusercontent.com/fangkuia/XPTV/main/js/missav.js"
          [Pornhub]="https://raw.githubusercontent.com/Yswag/xptv-extensions/main/js/pornhub.js"
          [PPP.Porn]="https://raw.githubusercontent.com/fangkuia/XPTV/main/js/ppp.js"
          [SupJav]="https://raw.githubusercontent.com/fangkuia/XPTV/main/js/SupJav.js"
          [xHamster]="https://raw.githubusercontent.com/Yswag/xptv-extensions/main/js/xhamster.js"
          [Huadu]="https://raw.githubusercontent.com/Yswag/xptv-extensions/main/js/hdys.js"
          [Madou]="https://raw.githubusercontent.com/Yswag/xptv-extensions/main/js/madou.js"
          [Rou]="https://raw.githubusercontent.com/fangkuia/XPTV/main/js/rou.js"
          [Taohuazu]="https://raw.githubusercontent.com/Yswag/xptv-extensions/main/js/taohuazu.js"
          [HongKongDoll]="https://raw.githubusercontent.com/Yswag/xptv-extensions/main/js/hkdoll.js"
          [UAA]="https://raw.githubusercontent.com/fangkuia/XPTV/main/js/uua.js"
          [harunasan]="https://gist.githubusercontent.com/Yswag/d9f072b75dab5b1b107c523dd148eea3/raw/harunasan.js"
        )
        
        for js_name in "${!jsfiles[@]}"; do
          url="${jsfiles[$js_name]}"
          curl -A -L -o "VOD-CMS/XPTV/JS/${js_name}.js" "$url"
          sed -i "1s|^|// 引用链接: $url\n|" "VOD-CMS/XPTV/JS/$js_name.js"
        done

    - name: Commit and push changes
      working-directory: VOD-CMS
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"
        git add XPTV/JS/
        git commit -m "Synchronously Update JS files" || echo "No changes to commit"
        git push
